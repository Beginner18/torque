#!/bin/bash
#
# pbs_mom_stop - stop pbs_mom daemon
#
# Note: This script should be copied to:
#
#   @sbindir@
#
# when using systemd and the associated TORQUE unit files.
#

# pbs_mom's pid should be passed as argument 1.
# See the pbs_mom.service unit file for systemd for how this is done.
pid=$1

# try up to 5 times to shutdown pbs_mom
for i in {1..5}; do

  # if pid is gone, exit
  kill -0 $pid &>/dev/null || exit 0

  # shutdown pbs_mom
  @sbindir@/momctl -s && exit $?

  # sleep before trying again
  sleep 1

done

exit 1
